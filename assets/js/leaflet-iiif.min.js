/**
 * Minified by jsDelivr using UglifyJS v3.3.21.
 * Original file: /npm/leaflet-iiif@2.0.1/leaflet-iiif.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
L.TileLayer.Iiif=L.TileLayer.extend({options:{continuousWorld:!0,tileSize:256,updateWhenIdle:!0,tileFormat:"jpg",fitBounds:!0,setMaxBounds:!1},initialize:function(i,t){(t=void 0!==t?t:{}).maxZoom&&(this._customMaxZoom=!0),t.tileSize&&(this._explicitTileSize=!0),t.quality&&(this._explicitQuality=!0),t=L.setOptions(this,t),this._infoDeferred=new $.Deferred,this._infoUrl=i,this._baseUrl=this._templateUrl(),this._getInfo()},getTileUrl:function(i){var t=this,o=i.x,e=i.y,n=t._getZoomForUrl(),a=Math.pow(2,t.maxNativeZoom-n),s=t.options.tileSize*a,l=o*s,r=e*s,m=Math.min(l+s,t.x)-l,p=Math.min(r+s,t.y)-r;return L.Util.template(this._baseUrl,L.extend({format:t.options.tileFormat,quality:t.quality,region:[l,r,m,p].join(","),rotation:0,size:Math.ceil(m/a)+","},this.options))},onAdd:function(n){var a=this;$.when(a._infoDeferred).done(function(){a._imageSizesOriginal=a._imageSizes.slice(0),n._layersMaxZoom=a.maxZoom;for(var i=a._imageSizes[0],t=a._map.getSize(),o=0,e=1;e<=5&&(i.x>t.x||i.y>t.y);e++)i=i.divideBy(2),a._imageSizes.unshift(i),o=-e;a.options.minZoom=o,a.options.minNativeZoom=o,a._prev_map_layersMinZoom=a._map._layersMinZoom,a._map._layersMinZoom=o,L.TileLayer.prototype.onAdd.call(a,n),a.options.fitBounds&&a._fitBounds(),a.options.setMaxBounds&&a._setMaxBounds(),a.on("tileload",function(i,t){var o=i.tile.naturalHeight,e=i.tile.naturalWidth;256===o&&256===e||(i.tile.style.width=e+"px",i.tile.style.height=o+"px")})})},onRemove:function(i){var t=this;i._layersMinZoom=t._prev_map_layersMinZoom,t._imageSizes=t._imageSizesOriginal,t.options.setMaxBounds&&i.setMaxBounds(null),L.TileLayer.prototype.onRemove.call(t,i)},_fitBounds:function(){var i=this,t=i._getInitialZoom(i._map.getSize()),o=i._imageSizes.length-1-i.options.maxNativeZoom,e=i._imageSizes[t+o],n=i._map.options.crs.pointToLatLng(L.point(0,e.y),t),a=i._map.options.crs.pointToLatLng(L.point(e.x,0),t),s=L.latLngBounds(n,a);i._map.fitBounds(s,!0)},_setMaxBounds:function(){var i=this,t=i._getInitialZoom(i._map.getSize()),o=i._imageSizes[t],e=i._map.options.crs.pointToLatLng(L.point(0,o.y),t),n=i._map.options.crs.pointToLatLng(L.point(o.x,0),t),a=L.latLngBounds(e,n);i._map.setMaxBounds(a,!0)},_getInfo:function(){var p=this;$.getJSON(p._infoUrl).done(function(i){p.y=i.height,p.x=i.width;var t,o,e,n,a,s=[],l=[];function r(i){return Math.ceil(Math.log(i)/Math.LN2)}i.profile instanceof Array?p.profile=i.profile[0]:p.profile=i.profile,p._setQuality(),p._explicitTileSize||(p.options.tileSize=256,i.tiles?p.options.tileSize=i.tiles[0].width:i.tile_width&&(p.options.tileSize=i.tile_width)),p.maxNativeZoom=Math.max(r(p.x/p.options.tileSize),r(p.y/p.options.tileSize)),p.options.maxNativeZoom=p.maxNativeZoom,p._customMaxZoom&&p.options.maxZoom>p.maxNativeZoom?p.maxZoom=p.options.maxZoom:p.maxZoom=p.maxNativeZoom;for(var m=0;m<=p.maxZoom;m++)t=Math.pow(2,p.maxNativeZoom-m),o=Math.ceil(p.x/t),e=Math.ceil(p.y/t),n=Math.ceil(o/p.options.tileSize),a=Math.ceil(e/p.options.tileSize),s.push([n,a]),l.push(L.point(o,e));p._tierSizes=s,p._imageSizes=l,p._infoDeferred.resolve()})},_setQuality:function(){var i=this.profile;if(!this._explicitQuality)switch("object"==typeof i&&(i=i["@id"]),!0){case/^http:\/\/library.stanford.edu\/iiif\/image-api\/1.1\/compliance.html.*$/.test(i):this.options.quality="native";break;default:this.options.quality="default"}},_infoToBaseUrl:function(){return this._infoUrl.replace("info.json","")},_templateUrl:function(){return this._infoToBaseUrl()+"{region}/{size}/{rotation}/{quality}.{format}"},_isValidTile:function(i){this._tileCoordsToBounds(i);var t=this._getZoomForUrl(),o=this._tierSizes[t],e=i.x,n=i.y;return t<0&&0<=e&&0<=n||!!o&&!(e<0||o[0]<=e||n<0||o[1]<=n)},_getInitialZoom:function(i){for(var t,o=this._imageSizes.length-1-this.options.maxNativeZoom,e=this._imageSizes.length-1;0<=e;e--)if(.8*(t=this._imageSizes[e]).x<i.x&&.8*t.y<i.y)return e-o;return 2}}),L.tileLayer.iiif=function(i,t){return new L.TileLayer.Iiif(i,t)};
//# sourceMappingURL=/sm/a15a24356d9fbf6f23961e39febf890b999c2550eb1ea643783aba067831eb91.map